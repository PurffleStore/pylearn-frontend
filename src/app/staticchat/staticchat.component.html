

<div class="staticchat-container">
  <img routerLink="/" src="assets/staticchat/back.png" class="back-btn"/>
  <div class="nav-bar">MJ-CHAT</div>
  <div class="chat-container">
    <div class="chat-window">
      <button class="arrow-btn up" title="Prev message" (click)="showPreviousPair()">‚Üë</button>

      <!-- MESSAGES -->
      <div class="chat-messages" #chatContainer>
        <div *ngFor="let pair of pairedMessages; let i = index" class="pair" [attr.data-index]="i">

          <!-- If user exists in pair (now shown first/top) -->
          <div *ngIf="pair.user" class="message-row user-row">
            <div class="message-bubble user-message">
              <span style="font-size:1.5vw;">{{ pair.user.text }}</span>
              <div class="message-time">
                {{ pair.user.timestamp | date:'shortTime' }}
              </div>
            </div>
            <img src="assets/staticchat/student.png" class="avatar" />
          </div>

          <!-- If bot exists in pair (now shown below user) -->
          <!-- If bot exists in pair -->
          <div *ngIf="pair.bot" class="message-row bot-row">
            <img src="assets/staticchat/teacher.png" class="avatar" />

            <div class="message-bubble bot-message">

              <!-- Default Bot Text -->
              <span style="font-size:1.5vw;"
                    *ngIf="!pair.bot.rawData?._activeText">
                {{ pair.bot.text }}
              </span>

              <!-- Detail / Story / Example Text -->
              <span style=""
                    *ngIf="pair.bot.rawData?._activeText">
                {{ pair.bot.rawData._activeText }}
              </span>

              <!-- Media Buttons -->
              <div class="mediaRow"
                   *ngIf="pair.bot.rawData &&
                (pair.bot.rawData?.audio_url ||
                 pair.bot.rawData?.video_url ||
                 pair.bot.rawData?.detail_url ||
                 pair.bot.rawData?.story_url ||
                 pair.bot.rawData?.example_url)">

                <!-- Audio -->
                <button class="chip"
                        *ngIf="pair.bot.rawData?.audio_url"
                        (click)="playAudio(pair.bot.rawData?.audio_url)">
                  üîä Audio
                </button>

                <!-- Main Video -->
                <button class="chip"
                        *ngIf="pair.bot.rawData?.video_url"
                        (click)="playResponseVideo(
                pair.bot.rawData?.video_url,
                false,
                pair.bot.rawData?.answer,
                pair.bot.rawData
              )">
                  üé¨ Video
                </button>

                <!-- Detail -->
                <button class="chip"
                        *ngIf="pair.bot.rawData?.detail_url"
                        (click)="playResponseVideo(
                pair.bot.rawData?.detail_url,
                true,
                pair.bot.rawData?.detail_text,
                pair.bot.rawData
              )">
                  üí° Detail
                </button>

                <!-- Story -->
                <button class="chip"
                        *ngIf="pair.bot.rawData?.story_url"
                        (click)="playResponseVideo(
                pair.bot.rawData?.story_url,
                true,
                pair.bot.rawData?.story_text,
                pair.bot.rawData
              )">
                  üìñ Story
                </button>

                <!-- Example -->
                <button class="chip"
                        *ngIf="pair.bot.rawData?.example_url"
                        (click)="playResponseVideo(
                pair.bot.rawData?.example_url,
                true,
                pair.bot.rawData?.example_text,
                pair.bot.rawData
              )">
                  üß™ Example
                </button>

              </div>

              <!-- Time -->
              <div class="message-time">
                {{ pair.bot.timestamp | date:'shortTime' }}
              </div>

            </div>
          </div>

        </div>

        <!-- Typing indicator -->
        <div *ngIf="isTyping" class="typing-indicator">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
      <button class="arrow-btn down" title="Next message" (click)="showNextPair()">‚Üì</button>

      <!-- SUGGESTIONS DROPDOWN -->
      <div *ngIf="showSuggestions && suggestedQuestions.length > 0" class="suggestions-box">
        <div *ngFor="let question of suggestedQuestions"
             class="suggestion-item"
             (click)="selectQuestion(question)">
          {{ question }}
        </div>
      </div>

      <!-- INPUT BAR -->
      <form [formGroup]="chatForm" (ngSubmit)="sendMessage()" class="chat-input">
        <!--<input type="text"
           formControlName="message"
           #messageInput
           placeholder="Type your message..."
           (focus)="onInputFocus()"
           (input)="onInputChange()"
           [readonly]="isSpeechProcessing" />-->
        <input type="text"
               formControlName="message"
               #messageInput
               [placeholder]="isListening ? '‚è∫ Listening...' : 'Type your message...'"
               (focus)="onInputFocus()"
               (input)="onInputChange()"
               (keyup.space)="handleSpaceKey()"
               [readonly]="isSpeechProcessing || isListening" />

        <button type="button"
                class="micBtn"
                [disabled]="!supported || isListening"
                (click)="toggleMic()">
          üé§
        </button>

        <div class="actions" *ngIf="showActions">
          <button class="reject" (click)="reject()">‚ùå</button>
          <button class="accept" (click)="accept()">‚úÖ</button>

        </div>

        <button type="submit" [disabled]="!chatForm.valid">
          ‚û§
        </button>
      </form>

    </div>


    <div class="video-window">

      <video #videoPlayer autoplay muted playsinline></video>
      <img class="play-pause-btn"
           [src]="(currentVideoType !== 'blink' && isVideoPlaying) ? 'assets/staticchat/pause.png' : 'assets/staticchat/play.png'"
           (click)="togglePlayPause()" />
    </div>
  </div>
</div>
